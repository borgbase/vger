# vger example configuration
# Copy this file to vger.yaml and adjust to your needs.

# Repositories to back up to.
# Top-level settings (encryption, compression, etc.) serve as defaults.
# Each repository entry can override: encryption, compression, retention,
# and source_directories.
# Select a single repo at runtime with: vger --repo <label-or-url>
#
# URL formats:
#   Local:  /backups/repo  or  file:///backups/repo
#   S3:     s3://bucket/prefix  or  s3://endpoint:port/bucket/prefix
#   SFTP:   sftp://user@host/path  (compile with feature 'backend-sftp')
#   REST:   https://backup.example.com/repo  (compile with feature 'backend-rest')
repositories:
  - url: /backups/myrepo
    label: main

  # S3 (AWS default endpoint — host is the bucket name):
  # - url: s3://my-bucket/vger
  #   label: aws
  #   region: us-east-1
  #   access_key_id: AKIA...
  #   secret_access_key: ...

  # S3-compatible (host with dot/port = custom endpoint, first path segment = bucket):
  # - url: s3://minio.local:9000/my-bucket/vger
  #   label: minio
  #   region: us-east-1
  #   access_key_id: minioadmin
  #   secret_access_key: minioadmin

  # SFTP:
  # - url: sftp://backupuser@nas.example.com/backups/vger
  #   label: remote
  #   sftp_key: ~/.ssh/id_ed25519

  # REST server (vger-server):
  # - url: https://backup.example.com/myrepo
  #   label: server
  #   rest_token: "secret-token-here"

  # Per-repo hooks — run only for this repository:
  # - url: /mnt/nas/repo
  #   label: nas
  #   hooks:
  #     before:
  #       - "mount /mnt/nas"
  #     finally:
  #       - "umount /mnt/nas"

  # Per-repo overrides:
  # - url: s3://my-bucket/vger
  #   label: offsite
  #   region: us-east-1
  #   encryption:
  #     passcommand: "pass show vger-remote"
  #   compression:
  #     algorithm: zstd              # override: better ratio for remote
  #   retention:
  #     keep_daily: 30               # override: keep more on remote
  #   source_directories:            # override: subset for remote
  #     - /home/user/documents

# Encryption settings
encryption:
  # Mode: "aes256gcm" or "none" (default: "aes256gcm")
  mode: aes256gcm

  # Passphrase (optional — if omitted, vger will prompt interactively)
  # passphrase: my-secret-passphrase

  # Shell command that outputs the passphrase on stdout (optional)
  # passcommand: "cat /path/to/passphrase-file"

# Directories to back up
source_directories:
  - /home/user/documents
  - /home/user/photos

# Glob patterns to exclude from backups
exclude_patterns:
  - "*.tmp"
  - "*.cache"
  - ".DS_Store"
  - "node_modules"

# Snapshot name format (default: "{hostname}-{now:%Y-%m-%dT%H:%M:%S}")
snapshot_name_format: "{hostname}-{now:%Y-%m-%dT%H:%M:%S}"

# Content-defined chunking parameters (FastCDC)
chunker:
  min_size: 524288    # 512 KiB (default)
  avg_size: 2097152   # 2 MiB (default)
  max_size: 8388608   # 8 MiB (default)

# Compression settings
compression:
  # Algorithm: "lz4", "zstd", or "none" (default: "lz4")
  algorithm: lz4

  # Zstd compression level, 1-22 (default: 3, only used when algorithm is "zstd")
  zstd_level: 3

# Hooks — shell commands to run before/after vger commands.
# Global hooks apply to all repositories. Per-repo hooks go in the repo entry.
#
# Hook types:
#   before / before_<cmd>   — runs before the command (failure aborts)
#   after / after_<cmd>     — runs after success only
#   failed / failed_<cmd>   — runs after failure only
#   finally / finally_<cmd> — runs always, regardless of outcome
#
# Variables: {repository}, {command}, {label}, {error}
# Env vars:  VGER_REPOSITORY, VGER_COMMAND, VGER_LABEL, VGER_ERROR
#
# hooks:
#   before_backup:
#     - "pg_dump mydb > /tmp/db.sql"
#   finally_backup:
#     - "rm -f /tmp/db.sql"
#   failed:
#     - "notify-send 'vger {command} failed: {error}'"

# Retention policy for `vger prune`
# At least one keep_* option must be set for prune to run.
# Snapshots matching multiple rules are kept (rules are additive).
retention:
  # Keep all snapshots created within this duration
  # Supported suffixes: h (hours), d (days), w (weeks), m (months ~30d), y (years ~365d)
  # A plain number is treated as days.
  keep_within: "2d"

  # Keep the N most recent snapshots
  keep_last: 5

  # Keep N snapshots per time bucket (newest in each bucket is kept)
  keep_hourly: 24
  keep_daily: 7
  keep_weekly: 4
  keep_monthly: 6
  keep_yearly: 2
